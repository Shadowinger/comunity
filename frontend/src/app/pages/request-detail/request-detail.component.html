<div class="flex flex-1 h-full w-full overflow-hidden bg-discord-channel">
  <div class="w-full h-full overflow-y-auto">
    <div class="w-full p-3 sm:p-6 flex flex-col items-center">
      <!-- Back button -->
      <div class="w-full max-w-2xl mb-3 sm:mb-4">
        <button (click)="goBack()" class="flex items-center gap-2 text-discord-muted hover:text-white transition-colors text-sm">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
          </svg>
          Zpƒõt
        </button>
      </div>

      <!-- Loading -->
      <div class="flex items-center gap-2 text-discord-muted w-full max-w-2xl" *ngIf="loading">
        <div class="animate-spin w-4 h-4 border-2 border-discord-blurple border-t-transparent rounded-full"></div>
        Naƒç√≠t√°n√≠...
      </div>

      <div *ngIf="request && !loading" class="w-full max-w-2xl">
        <!-- Header -->
        <div class="card mb-3 sm:mb-4 p-3 sm:p-4">
          <div class="flex flex-col sm:flex-row sm:items-start gap-3 sm:gap-4">
            <!-- Category icon -->
            <div class="hidden sm:flex w-12 h-12 rounded-lg bg-discord-blurple items-center justify-center text-white flex-shrink-0">
              <ng-container [ngSwitch]="request.category">
                <svg *ngSwitchCase="'moving'" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
                </svg>
                <svg *ngSwitchCase="'tutoring'" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M5 13.18v4L12 21l7-3.82v-4L12 17l-7-3.82zM12 3L1 9l11 6 9-4.91V17h2V9L12 3z"/>
                </svg>
                <svg *ngSwitchCase="'repair'" class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M22.7 19l-9.1-9.1c.9-2.3.4-5-1.5-6.9-2-2-5-2.4-7.4-1.3L9 6 6 9 1.6 4.7C.4 7.1.9 10.1 2.9 12.1c1.9 1.9 4.6 2.4 6.9 1.5l9.1 9.1c.4.4 1 .4 1.4 0l2.3-2.3c.5-.4.5-1.1.1-1.4z"/>
                </svg>
                <svg *ngSwitchDefault class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                </svg>
              </ng-container>
            </div>

            <div class="flex-1 min-w-0">
              <div class="flex flex-wrap items-center gap-2 sm:gap-3 mb-2">
                <h1 class="text-lg sm:text-2xl font-bold text-white">{{ request.title }}</h1>
                
                <!-- Status badge (non-owner) -->
                <span *ngIf="!isOwner()" class="inline-flex items-center px-2 sm:px-2.5 py-0.5 rounded text-xs font-medium"
                      [ngClass]="{
                        'bg-discord-green/20 text-discord-green': request.status === 'open',
                        'bg-discord-yellow/20 text-discord-yellow': request.status === 'in_progress',
                        'bg-discord-muted/20 text-discord-muted': request.status === 'closed'
                      }">
                  {{ request.status === 'open' ? 'Otev≈ôeno' : request.status === 'in_progress' ? 'Prob√≠h√°' : 'Uzav≈ôeno' }}
                </span>
                
                <!-- Status dropdown (owner can change) -->
                <select *ngIf="isOwner()" 
                        class="px-2 sm:px-2.5 py-0.5 rounded text-xs font-medium border-0 cursor-pointer"
                        [ngClass]="{
                          'bg-discord-green/20 text-discord-green': request.status === 'open',
                          'bg-discord-yellow/20 text-discord-yellow': request.status === 'in_progress',
                          'bg-discord-muted/20 text-discord-muted': request.status === 'closed'
                        }"
                        [value]="request.status"
                        (change)="changeStatus($any($event.target).value)">
                  <option value="open" [selected]="request.status === 'open'">üü¢ Otev≈ôeno</option>
                  <option value="in_progress" [selected]="request.status === 'in_progress'">üü° Prob√≠h√°</option>
                  <option value="closed" [selected]="request.status === 'closed'">‚ö´ Uzav≈ôeno</option>
                </select>
              </div>

              <!-- Meta info -->
              <div class="flex flex-wrap items-center gap-2 sm:gap-4 text-xs sm:text-sm text-discord-muted">
                <span class="flex items-center gap-1">
                  <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                  </svg>
                  <span class="truncate max-w-[100px] sm:max-w-none">{{ request.user_name || 'Anonym' }}</span>
                </span>
                <span class="flex items-center gap-1 uppercase tracking-wide">
                  <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
                  </svg>
                  {{ request.category }}
                </span>
                <span class="flex items-center gap-1">
                  <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"/>
                    <path d="M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                  </svg>
                  {{ request.created_at | date:'dd.MM.yyyy' }}
                </span>
              </div>
            </div>

            <!-- Action button -->
            <button
              *ngIf="request.user_id && request.user_id !== currentUserId"
              class="btn btn-primary w-full sm:w-auto flex-shrink-0 text-sm sm:text-base"
              (click)="openMessageDialog()">
              <svg class="w-4 h-4 mr-1 sm:mr-2" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
              </svg>
              <span class="sm:hidden">Zpr√°va</span>
              <span class="hidden sm:inline">Napsat zpr√°vu</span>
            </button>
          </div>
        </div>

        <!-- Description -->
        <div class="card mb-3 sm:mb-4 p-3 sm:p-4">
          <h2 class="text-base sm:text-lg font-semibold text-white mb-2 sm:mb-3 flex items-center gap-2">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-discord-muted flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
              <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
            </svg>
            Popis
          </h2>
          <p class="text-discord-text whitespace-pre-wrap text-sm sm:text-base">{{ request.description }}</p>
        </div>

        <!-- Message dialog -->
        <div *ngIf="showMessageDialog" class="card p-3 sm:p-4">
          <h3 class="text-base sm:text-lg font-semibold text-white mb-2 sm:mb-3 flex items-center gap-2">
            <svg class="w-4 h-4 sm:w-5 sm:h-5 text-discord-blurple flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
              <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/>
            </svg>
            <span class="truncate">Napsat u≈æivateli {{ request.user_name }}</span>
          </h3>
          <textarea
            class="input w-full mb-3 text-sm sm:text-base"
            rows="3"
            placeholder="Va≈°e zpr√°va..."
            [(ngModel)]="messageText"></textarea>
          <div class="flex flex-col sm:flex-row gap-2">
            <button class="btn btn-primary text-sm sm:text-base order-1 sm:order-none" (click)="sendMessage()" [disabled]="!messageText.trim()">
              <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
              Odeslat
            </button>
            <button class="btn btn-secondary text-sm sm:text-base order-2 sm:order-none" (click)="showMessageDialog = false">Zru≈°it</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
